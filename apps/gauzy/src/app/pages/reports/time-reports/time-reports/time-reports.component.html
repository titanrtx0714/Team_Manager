<nb-card>
	<nb-card-header>
		<h4>{{ 'REPORT_PAGE.TIME_AND_ACTIVITY_REPORT' | translate }}</h4>
		<div>
			{{ logRequest?.startDate | date }} -
			{{ logRequest?.endDate | date }}
		</div>
	</nb-card-header>
	<nb-card-body>
		<div class="filters row mb-3">
			<div class="col">
				<ngx-filters
					dateRange="custom_range"
					[hasEmployeeFilter]="false"
					(filtersChange)="filtersChange($event)"
				></ngx-filters>
			</div>
		</div>
		<div class="row">
			<div
				class="col-sm-4 col-md-3 col-lg"
				*ngxPermissionsOnly="PermissionsEnum.CHANGE_SELECTED_EMPLOYEE"
			>
				<nb-card
					[nbSpinner]="countsLoading"
					nbSpinnerSize="giant"
					nbSpinnerStatus="primary"
				>
					<nb-card-body>
						<p>
							{{ 'REPORT_PAGE.MEMBERS_WORKED' | translate }}
						</p>
						<div class="h1">
							{{ counts?.employeesCount || 0 }}
						</div>
					</nb-card-body>
				</nb-card>
			</div>
			<div class="col-sm-4 col-md-3 col-lg">
				<nb-card
					[nbSpinner]="countsLoading"
					nbSpinnerSize="giant"
					nbSpinnerStatus="primary"
				>
					<nb-card-body>
						<p>
							{{ 'REPORT_PAGE.PROJECTS_WORKED' | translate }}
						</p>
						<div class="h1">
							{{ counts?.projectsCount || 0 }}
						</div>
					</nb-card-body>
				</nb-card>
			</div>
			<div class="col-sm-4 col-md-3 col-lg">
				<nb-card
					[nbSpinner]="countsLoading"
					nbSpinnerSize="giant"
					nbSpinnerStatus="primary"
				>
					<nb-card-body>
						<p>
							{{ 'REPORT_PAGE.ACTIVITY' | translate }}
						</p>
						<div class="h1">{{ counts?.weekActivities || 0 }}%</div>
					</nb-card-body>
				</nb-card>
			</div>
			<div class="col-sm-4 col-md-3 col-lg">
				<nb-card
					[nbSpinner]="countsLoading"
					nbSpinnerSize="giant"
					nbSpinnerStatus="primary"
				>
					<nb-card-body>
						<p>
							{{ 'REPORT_PAGE.TOTAL_HOURS' | translate }}
						</p>
						<div class="h1">
							{{ counts?.weekDuration || 0 | durationFormat }}
						</div>
					</nb-card-body>
				</nb-card>
			</div>
		</div>
		<div class="daily-time-report my-3">
			<nb-card>
				<nb-card-body>
					<gauzy-time-report-horizontal-bar-chart></gauzy-time-report-horizontal-bar-chart>
				</nb-card-body>
			</nb-card>
		</div>
		<div class="table">
			<div class="row align-items-center">
				<div class="col-auto">Group By</div>
				<div class="col-sm-3">
					<nb-select
						[(ngModel)]="groupBy"
						(selectedChange)="filterChange()"
					>
						<nb-option value="date">Date</nb-option>
						<nb-option value="employee">Employee</nb-option>
						<nb-option value="project">Project</nb-option>
						<nb-option value="client">Client</nb-option>
					</nb-select>
				</div>
			</div>
			<div
				class="weekly-logs row-table"
				[nbSpinner]="loading"
				nbSpinnerSize="giant"
				nbSpinnerStatus="primary"
			>
				<div class="px-4">
					<div class="row py-3 font-weight-bold align-items-center">
						<div class="col-sm-2 project-name">
							{{ 'Project' | translate }}
						</div>
						<div class="col-sm-2 project-name">
							{{ 'REPORT_PAGE.EMPLOYEE' | translate }}
						</div>
						<div class="col-sm-3 text-center day-col">To-dos</div>
						<div class="col text-center day-col">Time</div>
						<div class="col text-center day-col">Activity</div>
					</div>
				</div>
				<ng-template
					[ngIf]="dailyData?.length > 0"
					[ngIfElse]="notFound"
				>
					<nb-card class="card" *ngFor="let day of dailyData">
						<nb-card-header class="card-title">{{
							day.date
						}}</nb-card-header>
						<nb-card-body
							class="cart-body project-row"
							*ngFor="let logs of day.logs"
						>
							<div
								class="employee-row"
								*ngFor="let projectLog of logs.projectLogs"
							>
								<div class="row py-3 align-items-center">
									<div class="col-sm-2 project-name">
										<span
											*ngIf="
												logs?.project;
												else noProjects
											"
											>{{ logs?.project?.name }}
										</span>
										<ng-template #noProjects>
											<span>{{
												'REPORT_PAGE.NO_PROJECT'
													| translate
											}}</span>
										</ng-template>
									</div>
									<div class="col-sm-2 project-name">
										<ngx-avatar
											*ngIf="projectLog?.employee"
											[src]="
												projectLog?.employee?.user
													?.imageUrl
											"
											[name]="
												projectLog?.employee?.user?.name
											"
										></ngx-avatar>
										<ng-template #noEmployee>
											<span>{{
												'REPORT_PAGE.NO_EMPLOYEE'
													| translate
											}}</span>
										</ng-template>
									</div>
									<div class="col-sm-3 text-center day-col">
										<span *ngIf="logs?.task; else noTasks"
											>{{ logs?.task?.title }}
										</span>
										<ng-template #noTasks>
											<span>{{
												'REPORT_PAGE.NO_TASK'
													| translate
											}}</span>
										</ng-template>
									</div>
									<div class="col text-center day-col">
										{{ projectLog.sum | durationFormat }}
									</div>
									<div class="col text-center day-col">
										{{ projectLog.activity || 0 }}%
									</div>
								</div>
							</div>
						</nb-card-body>
					</nb-card>
				</ng-template>
				<ng-template #notFound>
					<div class="row font-weight-bold py-3 align-items-center">
						<div class="col text-center">
							{{ 'REPORT_PAGE.NO_TIMELOG' | translate }}
						</div>
					</div>
				</ng-template>
			</div>
		</div>
	</nb-card-body>
</nb-card>
