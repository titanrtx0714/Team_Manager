<nb-card>
	<nb-card-header class="p-0">
		<div class="filters">
			<ngx-gauzy-filters
				[saveFilters]="(datePickerConfig$ | async).isSaveDatePicker"
				[hasLogTypeFilter]="false"
				[hasSourceFilter]="false"
				[hasActivityLevelFilter]="false"
				(filtersChange)="filtersChange($event)"
			></ngx-gauzy-filters>
		</div>
	</nb-card-header>
	<nb-card-body class="pt-0">
		<ng-container *ngIf="(isIndeterminate() || allChecked) && contextMenus">
			<div class="row">
				<div class="mb-3 col d-flex align-items-center">
					<button
						outline
						nbButton
						status="primary"
						[title]="'TIMESHEET.BULK_ACTION' | translate"
						[nbContextMenu]="contextMenus"
						nbContextMenuTag="timesheet-bulk-action"
					>
						{{ 'TIMESHEET.BULK_ACTION' | translate }}
						<nb-icon icon="chevron-down-outline"></nb-icon>
					</button>
				</div>
			</div>
		</ng-container>

		<div
			[nbSpinner]="loading"
			nbSpinnerSize="giant"
			nbSpinnerStatus="primary"
		>
			<div class="row custom-header m-0 align-items-center">
				<div class="col-auto">
					<nb-checkbox
						status="basic"
						[checked]="allChecked"
						[indeterminate]="isIndeterminate()"
						(checkedChange)="checkedAll($event)"
					>
					</nb-checkbox>
				</div>
				<div class="col-2">{{ 'TIMESHEET.EMPLOYEE' | translate }}</div>
				<div class="col">{{ 'TIMESHEET.TOTAL_TIME' | translate }}</div>
				<div class="col">{{ 'TIMESHEET.ACTIVITIES' | translate }}</div>
				<div class="col-3">{{ 'TIMESHEET.DURATION' | translate }}</div>
				<div class="col">{{ 'TIMESHEET.APPROVED_AT' | translate }}</div>
				<div class="col">
					{{ 'TIMESHEET.SUBMITTED_AT' | translate }}
				</div>
				<div class="col">{{ 'TIMESHEET.STATUS' | translate }}</div>
				<div class="col">{{ 'TIMESHEET.ACTION' | translate }}</div>
			</div>
			<ng-template [ngIf]="timesheets?.length > 0" [ngIfElse]="notFound">
				<div class="custom-body">
					<div
						[class]="
							timesheets.at(-1) == timesheet
								? 'row m-0 py-3 align-items-center'
								: 'row border-bottom m-0 py-3 align-items-center'
						"
						*ngFor="let timesheet of timesheets"
					>
						<div class="col-auto">
							<nb-checkbox
								[checked]="timesheet.checked"
								(checkedChange)="
									toggleCheckbox($event, timesheet)
								"
								status="basic"
							></nb-checkbox>
						</div>
						<div class="col-2">
							<ngx-avatar
								[name]="timesheet?.employee?.user?.name"
								[src]="timesheet?.employee?.user?.imageUrl"
								[id]="timesheet?.employee?.id"
							>
							</ngx-avatar>
						</div>
						<div class="col">
							{{ timesheet.duration | durationFormat }}
						</div>
						<div class="col">{{ timesheet.keyboard }}</div>
						<div class="col-3">
							{{ timesheet.startedAt | dateFormat }} -
							{{ timesheet.stoppedAt | dateFormat }}
						</div>
						<div class="col">
							{{ timesheet.approvedAt | dateFormat }}
						</div>
						<div class="col">
							{{ timesheet.submittedAt | dateFormat }}
						</div>
						<div class="col">
							<ga-status-badge
								[value]="statusMapper(timesheet)"
							></ga-status-badge>
						</div>
						<div class="col">
							<div>
								<button
									outline
									nbButton
									[nbPopover]="templateRef"
									nbPopoverPlacement="bottom"
								>
									{{ 'TIMESHEET.ACTION' | translate }}
								</button>
								<ng-template #templateRef>
									<div class="menu-item">
										<button
											(click)="redirectToView(timesheet)"
											class="m-1"
											nbButton
											ghost
											size="small"
											[innerHTML]="
												'TIMESHEET.VIEW' | translate
											"
										></button>
									</div>
									<div
										class="menu-item"
										*ngIf="!timesheet.submittedAt"
									>
										<button
											(click)="
												submitTimesheet(
													timesheet.id,
													'submit'
												)
											"
											class="m-1"
											nbButton
											ghost
											size="small"
											[innerHTML]="
												'TIMESHEET.SUBMIT_TIMESHEET'
													| translate
											"
										></button>
									</div>
									<div
										class="menu-item"
										*ngIf="timesheet.submittedAt"
									>
										<button
											(click)="
												submitTimesheet(
													timesheet.id,
													'unsubmit'
												)
											"
											class="m-1"
											nbButton
											ghost
											size="small"
											[innerHTML]="
												'TIMESHEET.UNSUBMIT_TIMESHEET'
													| translate
											"
										></button>
									</div>
									<div
										class="menu-item"
										*ngIf="
											timesheet.status !=
											TimesheetStatus.APPROVED
										"
									>
										<button
											(click)="
												updateStatus(
													timesheet.id,
													TimesheetStatus.APPROVED
												)
											"
											class="m-1"
											nbButton
											ghost
											size="small"
											[innerHTML]="
												'TIMESHEET.APPROVE' | translate
											"
										></button>
									</div>
									<div
										class="menu-item"
										*ngIf="
											timesheet.status !=
											TimesheetStatus.DENIED
										"
									>
										<button
											(click)="
												updateStatus(
													timesheet.id,
													TimesheetStatus.DENIED
												)
											"
											class="m-1"
											nbButton
											ghost
											size="small"
											[innerHTML]="
												'TIMESHEET.DENY' | translate
											"
										></button>
									</div>
								</ng-template>
							</div>
						</div>
					</div>
				</div>
			</ng-template>
			<ng-template #notFound>
				<div class="row font-weight-bold py-3 align-items-center">
					<div class="col text-center">
						{{ 'TIMESHEET.NO_TIMELOG' | translate }}
					</div>
				</div>
			</ng-template>
		</div>
	</nb-card-body>
</nb-card>
